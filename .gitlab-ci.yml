image: python:3.7.4-stretch

stages:
  - test
  - deploy

before_script:
  - python3 -m pip install --upgrade pip
  - pip install setuptools wheel twine
  - python setup.py sdist


test:
  stage: test
  script:
    # - python setup.py test
    - cd dist
    - rename -n "s/$(python setup.py --version)/$(python setup.py --version)-dev$CI_COMMIT_TAG/g" *.tar.gz

#deploy-staging:
#  stage: deploy
#  when: manual
#  variables:
#    TWINE_USERNAME: $STAGING_USERNAME
#    TWINE_PASSWORD: $STAGING_PASSWORD
#    TWINE_REPOSITORY_URL: $TEST_PYPI_REPOSITORY_URL
#  script:
#    - python setup.py sdist
#    - twine upload dist/*
#  only:
#    - develop
#    - master
#
#deploy-prod:
#  stage: deploy
#  when: manual
#  variables:
#    TWINE_USERNAME: $STAGING_USERNAME
#    TWINE_PASSWORD: $STAGING_PASSWORD
#  script:
#    - twine upload dist/*
#  only:
#    - tags

